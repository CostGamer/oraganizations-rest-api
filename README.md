# Organization Catalog API

## Описание проекта

**Organization Catalog API** — это RESTful API для работы с каталогом организаций и классификации их деятельности. С помощью данного API вы сможете:  
- Получать список организаций, находящихся в конкретных зданиях.  
- Искать организации по названию, типу деятельности или географическому расположению.  
- Использовать древовидную классификацию видов деятельности, ограниченную до трёх уровней вложенности.  
- Выполнять запросы к API с использованием токена.  

### Работа с токенами
Для работы с API требуется наличие токена, который можно получить с помощью следующих методов:  
- **POST** `/issue` — запрос на выдачу нового токена.  
- **GET** `/tokens` — получение списка всех выданных токенов.  

#### Ограничения
- Максимальное количество активных токенов на одного пользователя: **5**.  
- Лимит запросов с использованием одного токена: **100 запросов в час**.  

### Основные технологии:
- **Python** 3.12
- **FastAPI** — фреймворк для создания API
- **SQLAlchemy ORM** — для работы с базой данных
- **Alembic** — для миграций базы данных
- **Pydantic** — для валидации данных
- **Pytest** — для тестирования
- **Docker** — для контейнеризации и развертывания
- **PostgreSQL** - реляционная база данных, используемая для хранения и управления структурированными данными
- **PostGIS** - расширение для PostgreSQL, добавляющее поддержку географических объектов и операций с ними

## Установка

### Вариант 1: Локальная установка

1. **Клонирование репозитория**

   Для начала клонируйте репозиторий:

   ```bash
   git clone https://github.com/CostGamer/oraganizations-rest-api.git
   cd org_catalog
   ```

2. **Установка зависимостей**

   Убедитесь, что у вас установлен **Poetry** для управления зависимостями.

   - Установите зависимости с помощью **Poetry**:

   ```bash
   poetry install
   ```

   - Активируйте виртуальное окружение:

   ```bash
   poetry shell
   ```

3. **Установка pre-commit хуков (dev режим)**

   Для установки pre-commit хуков, используйте следующую команду:

   ```bash
   pre-commit install
   ```

4. **Создание переменных окружения**

   Создайте файл `.env` на примере `.env.example`

5. **Настройка базы данных**

   Запустите PostgreSQL с PostGIS через Docker:

   ```bash
    docker run --name postgres-postgis \
    --env-file=.env \
    -p 127.0.0.1:5432:5432 \
    -d postgis/postgis:15-3.3
   ```

6. **Запуск приложения**

   Для запуска приложения выполните команду:

   ```bash
   ./starts.sh
   ```

7. **Миграции базы данных**

    Для применения миграций базы данных используйте следующую команду:

    ```bash
    alembic upgrade head
    ```

8. **Тестовые данные**
    
    Импортируйте тестовые данные из файла **test_data.sql** 

Сервис будет доступен на `localhost:8000`.

### Вариант 2: Установка через Docker Compose

1. **Создание переменных окружения**

   Создайте файл `.env` на примере `.env.example`

2. **Запуск приложения через Docker Compose**

   Если вы хотите запустить приложение с помощью Docker, просто выполните следующую команду:

   ```bash
   docker-compose up --build -d
   ```

3. **Тестовые данные**
    
    Импортируйте тестовые данные из файла **test_data.sql** 

Сервис будет доступен на `localhost:8000`.


## Тестирование

1. Создайте тестовую базу данных:
    ```sql
    CREATE DATABASE mydb_test TEMPLATE mydb OWNER admin;
    ```

2. Настройте параметры подключения в `tests/__init__.py`

3. Запустите тесты:
    ```bash
    pytest -p no:warnings -v #без warning
    ```
    ```bash
    pytest -v 
    ```

## Структура проекта

```bash
├── app/                           # Основной каталог приложения
│   ├── __init__.py
│   ├── main.py                    # Точка входа FastAPI приложения
│   ├── api/                       # API маршруты
│   │   ├── exception_responses/   # Обработчики исключений
│   │   └── v1/                    # API версии 1
│   │       └── controllers/       # Контроллеры маршрутов
│   ├── core/                      # Основные конфигурации и утилиты
│   │   ├── configs/               # Конфигурации
│   │   ├── models/                # SQLAlchemy & Pydantic модели
│   │   ├── schemas/               # Protocols
│   │   ├── utils.py               # Утилиты
│   │   └── custom_exceptions.py   # Пользовательские исключения
│   ├── dependencies/              # Dependency Injection
│   ├── middleware/                # Middleware
│   ├── repositories/              # Репозитории для работы с БД
│   └── services/                  # Бизнес-логика
├── migrations/                    # Alembic миграции
│   └── versions/
├── tests/                         # Тесты
├── .env                          # Переменные окружения
├── .env.example                  # Пример конфигурации
├── .gitignore                    # Git ignore файл
├── .pre-commit-config.yaml       # Pre-commit конфигурация
├── alembic.ini                   # Конфигурация Alembic
├── app.log                       # Лог файл
├── docker-compose.yml            # Docker Compose
├── Dockerfile                    # Docker образ
├── init_postgis.sql              # Инициализация PostGIS
├── poetry.lock                   # Poetry lock файл
├── pyproject.toml                # Poetry конфигурация
├── py.typed                      # Типизация Python
├── README.md                     # Документация проекта
├── start.sh                      # Скрипт запуска
├── test_data.sql                 # Тестовые данные
└── test-task.md                  # Описание задачи
```

## Контакты

Если у вас возникли вопросы или предложения, можете связаться с нами по почте: `vladimirbryzgalov00@gmail.com`.